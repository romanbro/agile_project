<!DOCTYPE html>
<html lang="en">
  <head>
    <title>OBK MEDICAL</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,700" rel="stylesheet">
       <link rel="stylesheet" href="{{url_for('static', filename='css/open-iconic-bootstrap.min.css')}}">
        <link rel="stylesheet" href="{{url_for('static', filename='css/animate.css')}}">
        <link rel="stylesheet" href="{{url_for('static', filename='style.css')}}">
      <link rel="icon" href="{{url_for('static', filename='heart.jpg')}}">
  
      <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
      <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
  
      <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css">  </head>
  <body>


  <!-- START nav -->
  <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">
    <div class="container">
      <a class="navbar-brand" href="index.html"><i class="flaticon-pharmacy"></i><span>OBK</span> Medical Institute</a>
    </div>
  </nav>
    <!-- END nav -->


  <!--START Blue Header Strip-->
    <div class="hero-wrap" style="background-image: url('{{url_for('static', filename='surgery1.jpg')}}'); background-attachment:fixed;">
      <div class="overlay"></div>
        <div class="row no-gutters slider-text justify-content-center" >
          <div class="col-md-8 ftco-animate text-center">
            <div class = "test">
                <h1 class="mb-3 bread">Recovery starts here</h1>
            </div>
          </div>
        </div>
    </div>
  <!--END Blue Header Strip-->


  <section class="ftco-section contact-section ftco-degree-bg">
    <div class="container">
      <div class="row d-flex mb-5 contact-info">
        <div class="col-md-12 mb-4">
          <h2 class="h4">About us</h2>
        </div>
        <div class="w-100"></div>
          <div class="col">
            <p class="mediumPadd">Begin your journey to recovery with us. Our website provides a service that allows you to descover the hospitals that are optimal for you and your needs, in terms of procedure, price and location. We allow you to visualize your search results on a map and table to give you a better understanding of them and allow you to make your own comparisons. All these features are designed to give you the chance to choose the best option for you.</p>
          </div>
        </div>

      <div style="padding-bottom:20px; padding-right: 8px;">
        <div class = "tab">
          <button class="tablinks" onclick = "openSearch(event, 'Code')" id="defaultOpen">Procedure code</button>
          <button class="tablinks" onclick = "openSearch(event, 'Description')">Procedure description</button>
        </div>

        <!--START User Input Code Form-->
        <div id="Code" class="tabcontent">
          <p>Search by code of procedure</p>
          <form action=#>



            <div class="form-group">
              <div class="tooltip">Procedure Code:
                <span class="tooltiptext">Enter a 3 digit number</span>
              </div>
              <span> <input type="number" class="form-control" name="procCode" placeholder="111" maxlength="3"></span>
            </div>
            <div class="form-group">
              <div class="tooltip">Location:
                <span class="tooltiptext">Enter a state, address or zip code</span>
              </div>
              <span> <input type="address1" class="form-control" name="location" placeholder="Location"></span>
            </div>

            <p>Show results within: <span><select name="distanceFilter" class="dropDown">
              <option value="5Miles">5 miles</option>
              <option value="10Miles">10 miles</option>
              <option value="20Miles">20 miles</option>
              <option value="50Miles">50 miles</option>
              <option value="100Miles">100 miles</option>
              <option value="Anywhere">Anywhere</option>
            </select></span></p>

            <div class="row1">
              <div class="column1" style="text-align:center">
                <p>Min Price: $<span id="demo"></span></p>
              </div>
              <div class="column2" >
                <div class="price-slider">
                  <input type="range" min="2000" max="3000000" value="2000" name="minPrice" class="slider" id="minPrice" step = 1000 >
                  <input type="range" min="2000" max="3000000" value="3000000" name="maxPrice" class="slider1" id="maxPrice" step = 1000>
                </div>
              </div>
              <div class="column1" style="text-align:center">
                <p>Max Price: $<span id="demo1"></span></p>
              </div>
            </div>


            <div class="row">
              <div class="column">
                <!-- <p>Order results by:</p>
                <div class="form-group" >
                  <input type="radio" name="orderBy" value="closest" checked>  Distance<br>
                  <input type="radio" name="orderBy" value="priceLowToHigh" checked>  Price : Low-High<br>
                  <input type="radio" name="orderBy" value="priceHighToLow" checked>  Price : High-Low<br>
                </div>
              </div>
              <div class="column">
                <div class="form-group" style="float:right">
                  <p class="extraPadd"></p> -->
                  <div class="form-group" style="float:left">

                  <input onclick="codeAddress()" type="submit" value="Search" class="btn btn-primary py-3 px-5">
                </div>
              </div>
            </div>
          </form>
        </div>
      <!--END User Input Code Form-->


      <!--START User Input Description Form-->
        <div id="Description" class="tabcontent">
          <p>Search by description of procedure</p>
          <form action="#">
            <div class="form-group" >
              <div class="tooltip">Description:
                <span class="tooltiptext">Enter a description of your procedure</span>
              </div>
              <span> <input type="text" class="form-control" name="prodDesc" placeholder="Chest Pain"></span>
            </div>

            <div class="form-group">
              <div class="tooltip">Location:
                <span class="tooltiptext">Enter a state, address or zip code</span>
              </div>
              <span> <input type="address1" class="form-control" name="location" placeholder="Location"></span>
            </div>

            <p>Show results within: <span><select name="distanceFilter" class="dropDown">
              <option value="5Miles">5 miles</option>
              <option value="10Miles">10 miles</option>
              <option value="20Miles">20 miles</option>
              <option value="50Miles">50 miles</option>
              <option value="100Miles">100 miles</option>
              <option value="Anywhere">Anywhere</option>
            </select></span></p>


            <div class="row1">
              <div class="column1" style="text-align:center">
                <p>Min Price: $<span id="demo2"></span></p>
              </div>
              <div class="column2" >
                <div class="price-slider">
                  <input type="range" min="2000" max="3000000" value="2000" name="minPrice" class="slider2" id="minPrice1" step = 1000>
                  <input type="range" min="2000" max="3000000" value="3000000" name="maxPrice" class="slider3" id="maxPrice1" step = 1000>
                </div>
              </div>
              <div class="column1" style="text-align:center">
                <p>Max Price: $<span id="demo3"></span></p>
              </div>
            </div>


            <div class="row">
              <div class="column">
                <div class="form-group" >
                  <!-- <p>Order results by :</p>
                  <input type="radio" name="orderBy" value="closest" checked>  Distance<br>
                  <input type="radio" name="orderBy" value="priceLowToHigh" checked>  Price : Low-High<br>
                  <input type="radio" name="orderBy" value="priceHighToLow" checked>  Price : High-Low<br>
                </div>
              </div>
              <div class="column">
                <div class="form-group" style="float:right">
                  <p class="extraPadd"></p> -->
                  <div class="form-group" style="float:left">

                  <input type="submit" value="Search" class="btn btn-primary py-3 px-5">
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
      <!--END User Input Description Form-->


      <!--START Output-->
      <div class="row">
        <div class="column" style="text-align: center; padding: 20px">
          <div id = "showData">
            <!--######################CODE FOR TABLE GOES HERE########################-->
          </div>
        </div>
        
          
        
      </div>
      <div id="map"></div>
      <!--END Output-->
    </div>
  </section>

<!--START Blue Footer Strip-->
	<section class="ftco-section-parallax">
    <div class="parallax-img d-flex align-items-center">
      <div class="container">
        <div class="row d-flex justify-content-center">
          <div class="col-md-7 text-center heading-section heading-section-white ftco-animate">
            <h2>Contact Details</h2>
            <p></p>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!--END Blue Footer Strip-->

  <!--START Footer-->
  <footer>
    <div class="row">
      <div class="col-md-12 text-center">
        <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
          Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
      </div>
    </div>
  </footer>
  <!--END Footer-->


  <script>
    var slider = document.getElementById("minPrice");
    var output = document.getElementById("demo");

    output.innerHTML = slider.Value;
    slider.oninput = function() {
      output.innerHTML = this.value;
    }

    var slider1 = document.getElementById("maxPrice");
    var output1 = document.getElementById("demo1");

    output1.innerHTML = slider1.value;
    slider1.oninput = function() {
      output1.innerHTML = this.value;
    }

    var output2 = document.getElementById("demo2");
    var slider2 = document.getElementById("minPrice1");

    output2.innerHTML = slider2.value;
    slider2.oninput = function() {
      output2.innerHTML = this.value;
    }

    var slider3 = document.getElementById("maxPrice1");
    var output3 = document.getElementById("demo3");

    output3.innerHTML = slider3.value;
    slider3.oninput = function() {
      output3.innerHTML = this.value;
    }
  </script>

<script> 
  function CreateTableFromJSON() {
      
      // EXTRACT VALUE FOR HTML HEADER. 
      // 
      var col = [];
      for (var i = 0; i < database.length; i++) {
          for (var key in database[i]) {
              if (col.indexOf(key) === -1) {
                  col.push(key);
              }
          }
      }

      // CREATE DYNAMIC TABLE.
      var table = document.createElement("table");
      table.setAttribute("id", "example");

      // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.
      var header = table.createTHead();
      var tr = header.insertRow(-1);                   // TABLE ROW.

      for (var i = 0; i < col.length; i++) {
          var th = document.createElement("th");      // TABLE HEADER.
          th.innerHTML = col[i];
          tr.appendChild(th);
      }

      // ADD JSON DATA TO THE TABLE AS ROWS.
      var body = table.createTBody();
      for (var i = 0; i < database.length; i++) {

          tr = body.insertRow(-1);

          for (var j = 0; j < col.length; j++) {
              var tabCell = tr.insertCell(-1);
              tabCell.innerHTML = database[i][col[j]];
          }
      }

      // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
      var divContainer = document.getElementById("showData");
      divContainer.innerHTML = "";
      divContainer.appendChild(table);
  }
</script>

  <script> var map, destinationIcon, originIcon, bounds, geocoder, pos, markersArray, infoWindow
    var database = JSON.parse('{{ data | safe }}');
    var addresses = []
    for (x in database) {
      addresses.push(database[x].provider_street_address);
    }
    console.log(addresses)

    function initMap() {
      bounds = new google.maps.LatLngBounds;
      markersArray = [];
      pos = {
        lat: 39.8333333,
        lng: -98.585522
      };
      destinationIcon = 'https://chart.googleapis.com/chart?' +
        'chst=d_map_pin_letter&chld=D|FF0000|000000';
      originIcon = 'https://chart.googleapis.com/chart?' +
        'chst=d_map_pin_letter&chld=O|FFFF00|000000';
      map = new google.maps.Map(document.getElementById('map'), {
        center: pos,
        zoom: 7
      });

      geocoder = new google.maps.Geocoder;
      // Try HTML5 geolocation.
      infoWindow = new google.maps.InfoWindow;
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (position) {
          pos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };

          infoWindow.setPosition(pos);
          infoWindow.setContent('Your location found.');
          infoWindow.open(map);
          map.setCenter(pos);
        }, function () {
          handleLocationError(true, infoWindow, map.getCenter());
        });
      } else {
        // Browser doesn't support Geolocation
        handleLocationError(false, infoWindow, map.getCenter());
      }
    }

    function codeAddress() {
      var service = new google.maps.DistanceMatrixService;
      service.getDistanceMatrix({
        origins: [pos],
        destinations: addresses,
        travelMode: 'DRIVING',
        unitSystem: google.maps.UnitSystem.METRIC,
        avoidHighways: false,
        avoidTolls: false
      }, function (response, status) {
        if (status !== 'OK') {
          alert('Error was: ' + status);
        } else {
          var originList = response.originAddresses;
          var destinationList = response.destinationAddresses;
          // var outputDiv = document.getElementById('output');
          // outputDiv.innerHTML = "";
          deleteMarkers(markersArray);

          var showGeocodedAddressOnMap = function (asDestination, address) {
            var icon = asDestination ? destinationIcon : originIcon;
            return function (results, status) {
              if (status === 'OK') {
                map.fitBounds(bounds.extend(results[0].geometry.location));

                var marker = new google.maps.Marker({
                  map: map,
                  position: results[0].geometry.location,
                  icon: icon
                });
                markersArray.push(marker)
                // include a infowindow on the marker with address
                if (asDestination = true) {
                  var infowindow = new google.maps.InfoWindow({
                    content: address
                  });
                } else {
                  var infowindow = new google.maps.InfoWindow({
                    content: address
                  });
                }
                marker.addListener('click', function () {
                  infowindow.open(map, marker);
                });
              } else {
                alert('Geocode was not successful due to: ' + status);
              }
            };
          };

          for (var i = 0; i < originList.length; i++) {
            var results = response.rows[i].elements;
            geocoder.geocode({ 'address': originList[i] },
              showGeocodedAddressOnMap(false, originList[i]));
            for (var j = 0; j < results.length; j++) {
              geocoder.geocode({ 'address': destinationList[j] },
                showGeocodedAddressOnMap(true, destinationList[j]));
                console.log(database)
                database[j]["distance"] = results[j].distance.text;
                delete database[j].hospital_referral_region_description;
                delete database[j].total_discharges;
                delete database[j].id;
                delete database[j].provider_id;
                delete database[j].provider_zip_code;
                delete database[j].provider_state;
                delete database[j].average_total_payments;
                delete database[j].average_covered_charges;
                delete database[j].provider_city;
                delete database[j].provider_street_address;
                console.log(database)
                console.log(results[j].distance.text)
                console.log(database[j].distance)
              // outputDiv.innerHTML += originList[i] + ' to ' + destinationList[j] +
              //   ': ' + results[j].distance.text + ' in ' +
              //   results[j].duration.text + '<br>';
            }
          }
          CreateTableFromJSON();
          
          $(document).ready(function() {
              $('#example').DataTable();
              // data: database
          } );
        
        }
      });
    }

    function deleteMarkers(markersArray) {
      for (var i = 0; i < markersArray.length; i++) {
        markersArray[i].setMap(null);
      }
      markersArray = [];
    }
    
  </script>
  <!-- // https://www.encodedna.com/javascript/populate-json-data-to-html-table-using-javascript.htm -->
  

<!-- <script src="{{url_for('static', filename='js/jquery.min.js')}}"></script> -->
<script src="{{url_for('static', filename='js/jquery-migrate-3.0.1.min.js')}}"></script>
<script src="{{url_for('static', filename='js/popper.min.js')}}"></script>
<script src="{{url_for('static', filename='js/bootstrap.min.js')}}"></script>
<script src="{{url_for('static', filename='js/jquery.easing.1.3.js')}}"></script>
<script src="{{url_for('static', filename='js/jquery.waypoints.min.js')}}"></script>
<script src="{{url_for('static', filename='js/jquery.stellar.min.js')}}"></script>
<script src="{{url_for('static', filename='js/owl.carousel.min.js')}}"></script>
<script src="{{url_for('static', filename='js/jquery.magnific-popup.min.js')}}"></script>
<script src="{{url_for('static', filename='js/aos.js')}}"></script>
<script src="{{url_for('static', filename='js/jquery.animateNumber.min.js')}}"></script>
<script src="{{url_for('static', filename='js/bootstrap-datepicker.js')}}"></script>
<script src="{{url_for('static', filename='js/jquery.timepicker.min.js')}}"></script>
<script src="{{url_for('static', filename='js/scrollax.min.js')}}"></script>
<!-- The async attribute allows the browser to render the page while the API loads -->
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCodmwd7VVmMb19CaPLKQOOmm5srQDVhz4&callback=initMap"></script>
<script src="{{url_for('static', filename='js/main.js')}}"></script>
<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>

  </body>
</html>
